{% load static %}
<html>
    <script lang="javascript" src="{% static 'analytics/xlsx.full.min.js' %}"></script>
    <script lang="javascript" src="{% static 'main/jquery-1.12.4.min.js' %}"></script>
    <script src="https://bossanova.uk/jspreadsheet/v4/jexcel.js"></script>
    <link rel="stylesheet" href="https://bossanova.uk/jspreadsheet/v4/jexcel.css" type="text/css" />
    <script src="https://jsuites.net/v4/jsuites.js"></script>
    <link rel="stylesheet" href="https://jsuites.net/v4/jsuites.css" type="text/css" />
    
    
    <div id="spreadsheet1"></div>
    <p><button id='download' onclick="down()">Export my spreadsheet as CSV</button></p>


    <input type="file" id="fileUploader" name="fileUploader" accept=".xls, .xlsx" style="display:none;"/>
    <input type='button' value='Load a XLSX file from my local computer' onclick="document.getElementById('fileUploader').click()">
    </br></br>
    JSON : <label id="jsonObject"> </label>
    <script>
        let arr;
        $(document).ready(function(){
            $("#fileUploader").change(function(evt){
                var selectedFile = evt.target.files[0];
                var reader = new FileReader();
                reader.onload = function(event) {
                    var data = event.target.result;
                    var workbook = XLSX.read(data, {
                        type: 'binary'
                    });
                    workbook.SheetNames.forEach(function(sheetName) {
                        var XL_row_object = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[sheetName]);
                        if (XL_row_object.length > 0) {
                            document.getElementById("jsonObject").innerHTML = JSON.stringify(XL_row_object);
                            //arr = JSON.stringify(XL_row_object);
                        }
                        arr=XLSX.utils.sheet_to_row_object_array(workbook.Sheets[sheetName]);
                        jspreadsheet(document.getElementById('spreadsheet1'), {
                            data:arr,
                            tableOverflow:true,
                            columns: [
                                {width :100},
                                {width :100},
                                {width :100},
                                {width :100},
                                {width :100}
                            ]
                        });
                    })
                };
                reader.onerror = function(event) {
                    console.error("File could not be read! Code " + event.target.error.code);
                };
                //           
                reader.readAsBinaryString(selectedFile);
            }); 
        });
        //document.getElementById('download').onclick = function () {
          //   document.getElementById('spreadsheet1').download();
        //}

        function down() {
            var wb = XLSX.utils.table_to_book(document.getElementById('spreadsheet1'), {sheet : "시트명", raw:true});
            XLSX.writeFile(wb, ('파일명.xlsx'));
        }
        // 각종 
        var changed = function(instance, cell, x, y, value) {
        var cellName = jexcel.getColumnNameFromId([x,y]);
        $('#log').append('New change on cell ' + cellName + ' to: ' + value + '');
        }
        
        var beforeChange = function(instance, cell, x, y, value) {
            var cellName = jexcel.getColumnNameFromId([x,y]);
            $('#log').append('The cell ' + cellName + ' will be changed');
        }
        
        var insertedRow = function(instance) {
            $('#log').append('Row added');
        }
        
        var insertedColumn = function(instance) {
            $('#log').append('Column added');
        }
        
        var deletedRow = function(instance) {
            $('#log').append('Row deleted');
        }
        
        var deletedColumn = function(instance) {
            $('#log').append('Column deleted');
        }
        
        var sort = function(instance, cellNum, order) {
            var order = (order) ? 'desc' : 'asc';
            $('#log').append('The column  ' + cellNum + ' sorted by ' + order + '');
        }
        
        var resizeColumn = function(instance, cell, width) {
            $('#log').append('The column  ' + cell + ' resized to width ' + width + ' px');
        }
        
        var resizeRow = function(instance, cell, height) {
            $('#log').append('The row  ' + cell + ' resized to height ' + height + ' px');
        }
        
        var selectionActive = function(instance, x1, y1, x2, y2, origin) {
            var cellName1 = jexcel.getColumnNameFromId([x1, y1]);
            var cellName2 = jexcel.getColumnNameFromId([x2, y2]);
        $('#log').append('The selection from ' + cellName1 + ' to ' + cellName2 + '');
        }
        
        var loaded = function(instance) {
            $('#log').append('New data is loaded');
        }
        
        var moveRow = function(instance, from, to) {
            $('#log').append('The row ' + from + ' was move to the position of ' + to + ' ');
        }
        
        var moveColumn = function(instance, from, to) {
            $('#log').append('The col ' + from + ' was move to the position of ' + to + ' ');
        }
        
        var blur = function(instance) {
            $('#log').append('The table ' + $(instance).prop('id') + ' is blur');
        }
        
        var focus = function(instance) {
            $('#log').append('The table ' + $(instance).prop('id') + ' is focus');
        }
        
        var paste = function(data) {
            $('#log').append('Paste on the table ' + $(instance).prop('id') + '');
        }
    </script>
</html>